@model Neutrinodevs.PedidosOnline.Domain.DTOs.User.UserAuthenticateDto
@{
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
    ViewData["Title"] = "Administración";
}
@section HeaderScripts{
    <script>
        var tbl_order_list;
        var order_list;

        const getData = (resp) => {
            order_list = JSON.parse(resp);
        }

        const getOrderList = () => {
            $.ajax({
                url: base_url+'/Dashboard/GetAll',
                async: false,
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                success: getData,
                error: function (err) {
                    console.log(err.responseText);
                }
            });
        }

        const updateOrdersTable = () => {
            getOrderList();
            console.log(order_list);
            tbl_order_list.clear().rows.add(order_list).draw();
        }
    </script>
}
<div class="row" style="margin-top:2rem">
    <div class="col-sm-12">
        <div class="box">
            <div class="box-head">
                <h2>Nuevos Pedidos</h2>
            </div>
            <div class="item">
                <div class="item-responsive ">
                    <table class="table table-hover" id="tbl_order_list">
                        <thead>
                            <tr>
                                <th scope="col"></th>
                                <th scope="col">Nº</th>
                                <th scope="col">FECHA/HORA</th>
                                <th scope="col">TOTAL</th>
                                <th scope="col">ESTADO</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody><!--/tbody-->
                    </table><!--/.table-->
                </div><!--/.table-responsive-->
            </div><!--/.item-->
        </div><!--/.box-->
    </div><!--/.col-->
</div><!--/.row-->
<script>


    $(document).ready(function () {
        getOrderList();
        //let order_list = getOrderList();
        tbl_order_list = $("#tbl_order_list").DataTable({
            "language": {
                "url": base_url+"/datatables.net/datatables-es_es.json"
            },
            paging: true,
            data: order_list,
            order: [],
            columns: [
                { data: 'id_order' },
                { data: 'number' },
                { data: 'date' },
                { data: 'total_amount', render: $.fn.dataTable.render.number(',', '.', 2, '') },
                { data: 'id_stage' },
            ],
            "columnDefs": [
                { "targets": 0, "visible": false, "searchable": false },
                {
                    targets: 4,
                    data: 'items',
                    "render": function (item, type, row, meta) {
                        if (item == 1) {
                            return '<span class="badge  alert-warning">' + row.stage + '</span>';
                        } else if (item == 2) {
                            return '<span class="badge  alert-info">' + row.stage + '</span>';
                        } else if (item == 3) {
                            return '<span class="badge alert-primary">' + row.stage + '</span>';
                        } else if (item == 4) {
                            return '<span class="badge alert-success">' + row.stage + '</span>';
                        } else {
                            return '<span class="badge alert-danger">' + row.stage + '</span>';
                        }

                    }
                },
            ]
        });
    });

   
</script>
@section Scripts{
    <script src="~/datatables.net/jquery.dataTables.min.js"></script>
    <script src="~/aspnet/signalr/dist/browser/signalr.min.js"></script>
    <script src="~/js/order/notify.js" type="text/javascript"></script>
    <script>
        connection.on("ReceiveNotifyOrder", function () {
            console.log('RECIBIDO');
            updateOrdersTable();
        });
    </script>
}